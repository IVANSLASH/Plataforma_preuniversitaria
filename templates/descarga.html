{% extends "base.html" %}

{% block title %}Descargar Formulario - {{ info.titulo }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card ejercicio-card">
                <div class="card-body text-center">
                    <h1 class="display-4 mb-3">
                        <i class="fas fa-download"></i> Descargar Formulario
                    </h1>
                    <p class="lead mb-0">
                        {{ info.titulo }}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Información del archivo -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-file-pdf"></i> Información del Archivo</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Detalles del Formulario</h5>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <strong><i class="fas fa-file-alt text-primary"></i> Nombre:</strong><br>
                                    {{ info.titulo }}
                                </li>
                                <li class="mb-2">
                                    <strong><i class="fas fa-info-circle text-info"></i> Descripción:</strong><br>
                                    {{ info.descripcion }}
                                </li>
                                <li class="mb-2">
                                    <strong><i class="fas fa-weight-hanging text-warning"></i> Tamaño:</strong><br>
                                    {{ info.tamaño }}
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>Información Técnica</h5>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <strong><i class="fas fa-code-branch text-success"></i> Versión:</strong><br>
                                    {{ info.version }}
                                </li>
                                <li class="mb-2">
                                    <strong><i class="fas fa-calendar text-danger"></i> Fecha:</strong><br>
                                    {{ info.fecha_actualizacion }}
                                </li>
                                <li class="mb-2">
                                    <strong><i class="fas fa-file-pdf text-danger"></i> Formato:</strong><br>
                                    PDF (Portable Document Format)
                                </li>
                            </ul>
                        </div>
                    </div>

                    {% if info.contenido %}
                    <div class="mt-4">
                        <h5><i class="fas fa-list"></i> Contenido Incluido</h5>
                        <div class="row">
                            {% for item in info.contenido %}
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    <span>{{ item }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    {% if info.capitulos_incluidos %}
                    <div class="mt-4">
                        <h5><i class="fas fa-book"></i> Capítulos Incluidos</h5>
                        <div class="row">
                            {% for capitulo in info.capitulos_incluidos %}
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fas fa-chapter text-info me-2"></i>
                                    <span>{{ capitulo }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Botones de descarga -->
    <div class="row justify-content-center mt-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-download"></i> Opciones de Descarga</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="d-grid">
                                <button class="btn btn-success btn-lg" onclick="simularDescarga()">
                                    <i class="fas fa-download"></i> Descargar Ahora
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="d-grid">
                                <button class="btn btn-outline-primary btn-lg" onclick="verVistaPrevia()">
                                    <i class="fas fa-eye"></i> Vista Previa
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <h6><i class="fas fa-info-circle"></i> Nota:</h6>
                        <p class="mb-0">
                            Este es un formulario simulado. En una implementación real, aquí se descargaría el archivo PDF 
                            real desde el servidor. El archivo contiene todas las propiedades y fórmulas organizadas de manera 
                            clara y fácil de consultar.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navegación -->
    <div class="row justify-content-center mt-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-compass"></i> Navegación</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <a href="/formularios" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-arrow-left"></i> Volver a Formularios
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="/teoria" class="btn btn-outline-primary w-100">
                                <i class="fas fa-book-open"></i> Ver Teoría
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="/" class="btn btn-outline-info w-100">
                                <i class="fas fa-home"></i> Inicio
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function simularDescarga() {
    // Simular descarga
    const btn = event.target;
    const originalText = btn.innerHTML;
    
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Descargando...';
    btn.disabled = true;
    
    setTimeout(() => {
        btn.innerHTML = '<i class="fas fa-check"></i> ¡Descargado!';
        btn.className = 'btn btn-success btn-lg';
        
        // Mostrar notificación
        mostrarNotificacion('Formulario descargado exitosamente', 'success');
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
            btn.className = 'btn btn-success btn-lg';
        }, 2000);
    }, 2000);
}

function verVistaPrevia() {
    // Simular vista previa
    const btn = event.target;
    const originalText = btn.innerHTML;
    
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando...';
    btn.disabled = true;
    
    setTimeout(() => {
        btn.innerHTML = '<i class="fas fa-eye"></i> Vista Previa';
        btn.disabled = false;
        
        // Mostrar modal de vista previa
        mostrarVistaPrevia();
    }, 1500);
}

function mostrarNotificacion(mensaje, tipo) {
    const toast = document.createElement('div');
    toast.className = `position-fixed bottom-0 end-0 p-3`;
    toast.style.zIndex = '11';
    toast.innerHTML = `
        <div class="toast show" role="alert">
            <div class="toast-header">
                <strong class="me-auto">${tipo === 'success' ? 'Éxito' : 'Info'}</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                ${mensaje}
            </div>
        </div>
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        document.body.removeChild(toast);
    }, 3000);
}

function mostrarVistaPrevia() {
    const modal = document.createElement('div');
    modal.className = 'modal fade show';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Vista Previa - {{ info.titulo }}</h5>
                    <button type="button" class="btn-close" onclick="cerrarModal()"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-file-pdf fa-5x text-danger mb-3"></i>
                        <h5>{{ info.titulo }}</h5>
                        <p class="text-muted">{{ info.descripcion }}</p>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Esta es una vista previa simulada. El archivo real contendría todas las fórmulas y propiedades 
                            organizadas en formato PDF para fácil consulta e impresión.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal()">Cerrar</button>
                    <button type="button" class="btn btn-success" onclick="simularDescarga(); cerrarModal();">
                        <i class="fas fa-download"></i> Descargar
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function cerrarModal() {
    const modal = document.querySelector('.modal');
    if (modal) {
        document.body.removeChild(modal);
    }
}
</script>
{% endblock %} 